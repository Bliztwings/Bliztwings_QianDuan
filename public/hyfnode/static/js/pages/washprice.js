function InitRoot(){$(".loader").show(),$.post("/hyfnode/base/getRoot",{},function(t){if(t.data.data&&t.data.data.length>0){var e={data:t.data.data},a=GetRequest().id||0;e.data[a].active=!0;var n=template("category-menu",e);$("header .menu").html(n),$("header .menu").on("click","li",function(t){$(".loader").show(),$("header .menu li").removeClass("active"),$(this).addClass("active"),InitRoot2($(this).attr("data-id"))}),InitRoot2(e.data[a].id)}})}function InitRoot2(t){$.post("/hyfnode/base/getRoot2",{id:t},function(t){if(t.data.data&&t.data.data.length>0){var e={data:t.data.data};e.data[0].active=!0;var a=template("category-submenu",e);$(".sub-menu-wrap").html(a),$(".sub-menu-wrap").on("click","span",function(t){$(".sub-menu-wrap span").removeClass("active"),$(".loader").show(),$(this).addClass("active"),InitRoot3($(this).attr("data-id"))}),InitRoot3(e.data[0].id)}})}function InitRoot3(t){$.post("/hyfnode/base/getRoot3",{id:t},function(t){if(t.data.data&&t.data.data.length>0){var e={clothes:t.data.data},a=template("price-content",e);$(".prices-content-wrap").html(a),showProductResult(),$(".loader").hide()}})}function renderForecast(t){var e=template("forecast",t);$("#forecast-wrap").html(e)}function countTotalPrice(t,e){for(var e=e||"add",a=window.sessionStorage,n=JSON.parse(a.getItem("productInfo")),o=n.washing.length,i=0;i<o;i++)if(+n.washing[i].id==+t){"add"===e&&(n.washing[i].selected=!0),"sub"===e&&(n.washing[i].selected=!1);break}for(var r=0,c=0,i=0;i<o;i++)n.washing[i].selected&&(r+=+n.washing[i].price*+n.washing[i].order,c+=+n.washing[i].order);$("footer .total-price").text(r.toFixed(2)),$("footer .buy-number-total").text(c),a.setItem("productInfo",JSON.stringify(n))}function addOrSub(t,e,a){for(var n=window.sessionStorage,o=JSON.parse(n.getItem("productInfo")),i=o.washing.length,r=0;r<i;r++){if(t==o.washing[r].id&&"sub"===e){o.washing[r].order--,$(a).next().text(o.washing[r].order),0==+o.washing[r].order&&($(a).closest("li").remove(),o.washing.splice(r,1));break}if(t==o.washing[r].id&&"add"===e){o.washing[r].order++,$(a).prev().text(o.washing[r].order);$(a).text();break}}n.setItem("productInfo",JSON.stringify(o)),$(a).closest("li").children(".select").hasClass("checked")&&countTotalPrice(t),"sub"!==e||o.washing.length||($("#forecast-wrap").empty(),$(".buy-number-total").empty().hide(),$(".buy-number").empty().hide(),renderOrder($("header").find(".active").data("coupon_info")))}function showProductResult(){var t=window.sessionStorage,e=JSON.parse(t.getItem("productInfo"));if(e){if(!$.contains($("footer").get(0),$(".shopping-cart-wrap").get(0))){var a=template("shopping-cart",{});$("footer").html(a)}for(var n=0,o=0,i=e.washing.length,r=0;r<i;r++)n+=e.washing[r].order,o+=e.washing[r].order*e.washing[r].price;$("footer .buy-number-total").text(n).show(),$("footer .total-price").text(o.toFixed(2));for(var c=$("header li.active").data("id"),r=0;r<i;r++)if(+e.washing[r].category_id===c){if($.contains($(".prices-content-wrap").get(0),$(".price-box").get(0)))for(var s=$(".prices-content-wrap .price-box").length,d=0;d<s;d++)if($(".prices-content-wrap .price-box").eq(d).data("id")===+e.washing[r].id){$(".prices-content-wrap .price-box").eq(d).find(".buy-number").text(e.washing[r].order).show();break}if($(".taocan-wrap").children().length)for(var l=$(".taocan-wrap .taocan").length,h=0;h<l;h++)$(".taocan-wrap .taocan").eq(h).find(".taocan-pic-cell").data("id")===+e.washing[r].id&&$(".taocan-wrap .taocan").eq(h).find(".taocan-pic-cell .buy-number").text(e.washing[r].order).show();1030===c&&$.contains($(".prices-content-wrap").get(0),$(".curtain-content").get(0))&&($(".curtain-content .big-bag").data("id")===+e.washing[r].id&&$(".big-bag .buy-number").text(e.washing[r].order).show(),$(".curtain-content .small-bag").data("id")===+e.washing[r].id&&$(".small-bag .buy-number").text(e.washing[r].order).show()),1070===c&&$(".bag-content").length&&1070==+e.washing[r].category_id&&$(".bag-content .buy-number").text(e.washing[r].order).show()}}}function renderOrder(t){var e=template("order",{coupon_info:"请选择您需要的服务"});$("footer").html(e)}function cleanShoppingCat(){$("#forecast-wrap").empty(),$(".buy-number-total").empty().hide(),$(".buy-number").empty().hide(),$(".total-price").text("0.0"),renderOrder($("header").find(".active").data("coupon_info")),window.sessionStorage.clear()}function confirm(t,e){var a=template("alert-dialog-wrap",{tips:{title:t,content:e}});$("#dialog").html(a),$("#alert-dialog").show(),$("#dialog").on("click",".i-know-btn",function(t){$("#alert-dialog").hide()})}function getCookie(t){var e,a=new RegExp("(^| )"+t+"=([^;]*)(;|$)");return(e=document.cookie.match(a))?unescape(e[2]):null}function stringEncode(t){var e=document.createElement("div");return e.innerText?e.innerText=t:e.textContent=t,e.innerHTML}function GetRequest(){var t=location.search,e={};if(-1!=t.indexOf("?")){var a=t.substr(1);strs=a.split("&");for(var n=0;n<strs.length;n++)e[strs[n].split("=")[0]]=unescape(strs[n].split("=")[1])}return e}InitRoot(),$("footer").on("click",".shopping-cart img:first-child",function(t){var e=JSON.parse(window.sessionStorage.getItem("productInfo"));e&&renderForecast(e)}),$("#forecast-wrap").on("click",".head span:first-child",function(t){confirm("操作提示","确认清空选项吗？"),$("#dialog").on("click","#alert-dialog .ok",function(t){cleanShoppingCat(),$("#dialog").empty()}),$("#dialog").on("click","#alert-dialog .cancel",function(t){$("#dialog").empty()})}),$("#forecast-wrap").on("click",".head span:last-child",function(t){$("#forecast-wrap").empty()}),$("#forecast-wrap").on("click",".clothes-list .select",function(t){$(this).hasClass("checked")?($(this).removeClass("checked").addClass("unchecked"),countTotalPrice($(this).data("id"),"sub")):($(this).removeClass("unchecked").addClass("checked"),countTotalPrice($(this).data("id"),"add"))}),$("#forecast-wrap").on("click",".add-subtract span:first-child",function(t){addOrSub($(this).data("id"),"sub",this)}),$("#forecast-wrap").on("click",".add-subtract span:last-child",function(t){addOrSub($(this).data("id"),"add",this)}),$("footer").on("click",".order-btn",function(){window.sessionStorage.setItem("orderplace_item",$(".menu li.active").index()),window.location.href="/hyfnode/orderplace"});