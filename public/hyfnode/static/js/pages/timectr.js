function getSearchParams(){for(var e={},t=location.search.substr(1).split(/&/g),i=0;i<t.length;i++)try{var o=t[i].split("=",2),a=o[0],r=decodeURIComponent(o[1]);e[a]=r}catch(e){}return e}function time_info(e){var t=e,i=template("data-text",t),o=template("date-range",t);document.getElementById("time_controler").innerHTML=i,document.getElementById("time_range").innerHTML=o}function time2_info(e,t){var i=e.data[t],o=template("quotainfo",{data_handled:i});document.getElementById("quota-info").innerHTML=o,console.log(i.quota_info),console.log(o)}function click_tab(e){$("#time_controler li").addClass("tab-current").siblings().removeClass("tab-current"),$("#time_range > .time_hour").first().show().siblings().hide(),$("#time_controler li").click(function(){$(".time_hour li").removeClass("selected"),$(".time_hour li").removeClass("select_hour"),$("#time_controler li").removeClass("selected");var t=$("#time_controler li").index(this);$(this).addClass("tab-current").siblings().removeClass("tab-current"),time2_info(e,t),$("#time_range > .time_hour").eq(t).show().siblings().hide(),$(".time_hour li").hasClass("select_hour")&&$(".time_hour li").hasClass("selected")||$("#order-btn").prop("disabled",!0).css({opacity:".5"})})}function selected_time(){$(".time_hour li").hasClass("selected")&&($("#order-btn").prop("disabled",!1).css({opacity:"1"}),click_btn())}function range_tab(){$("#order-btn").prop("disabled",!0).css({opacity:".5"}),$(".time_hour li").click(function(){$(".time_hour li").removeClass("selected"),$(this).hasClass("baodan")||($(this).find(".special_delivery_fee").show(),$(this).addClass("select_hour").siblings().removeClass("select_hour"),$(".time_hour li").removeClass("selected"),$(this).hasClass("select_hour")&&($("#order-btn").prop("disabled",!1).css({opacity:"1"}),click_btn()),$(".close-btn").click(function(e){$(".special_delivery_fee").hide(),$(".time_hour li").removeClass("select_hour"),$("#order-btn").prop("disabled",!0).css({opacity:".5"}),e.stopPropagation()}),$(".sure-btn").click(function(e){$(".special_delivery_fee").hide(),e.stopPropagation()}))})}function click_btn(){$("#order-btn").click(function(){var e=$(".tab-current,.selected").attr("date_text"),t=$(".time_hour .select_hour,.time_hour .selected").attr("serv_time");if("orderplace"==param.from)location.href="/hyfnode/orderplace?washing_date_text="+(e||"")+"&washing_time="+(t||"");else if(param.id){var i={date:e,time:t,id:param.id};$.post("/hyfnode/base/order/changetime",i,function(e){showTip("修改成功","/order")},"json")}})}function showTip(e,t,i){$("#show_mes").html(e),t?$("#tip-box").show().delay(2e3).hide(function(){window.location.href=t}):i?$("#tip-box").show():$("#tip-box").show().delay(2e3).hide(0)}var api={},preLocation;api.pagejson="/hyfnode/base/time",preLocation="";var param=getSearchParams();$.ajax({url:"/hyfnode/base/time",type:"GET",data:{},dataType:"json"}).done(function(e){(e=e.data).ret?(time_info(e),time2_info(e,0),click_tab(e),range_tab(),selected_time()):location.href=e.error.url}).fail(function(){alert("网络错误，请稍后再试")});